<!DOCTYPE html>
<html lang="es-VE">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="Author" content="Manuel Martinez" />
        <meta name="Description" content="Jugar Batalla Naval desde 2 a 4 personas" />
        <meta name="keywords" content="HTML, CSS, JS, Batalla Naval, juego" />
        <meta name="robots" content="noindex, nofollow" />
        <!-- 
        <link rel="stylesheet" href="barraDeNavegacion.css">
        <link rel="stylesheet" href="tablero.css">
        -->
        <link rel="stylesheet" href="./styles/barraDeNavegacion.css">
        <link rel="stylesheet" href="./styles/tablero.css">

        <title>Batalla Naval | Instrucciones</title>
    </head>
    <body>
        <header>
            <h1> <img src="./images/icono-battleship.jpg"> Batalla Naval</h1>
            <nav class="navbar">
                <ul>
                    <li><a href="inicio.html">Inicio</a></li>
                    <li><a href="instrucciones.html">Instrucciones</a></li>
                    <li><a href="jugar.html">Jugar</a></li>
                </ul>
            </nav>
        </header>

        <main>
    
            <div id="tablero">
                      
            </div>
    

            <aside id="side-menu">
                <h2>Datos del Turno</h2>
                <div id="datos-del-turno">
                    <h2>Turno del Jugador: X</h2>
                    <h2>Tablero del Jugador X</h2>
                    <h2>Tiempo del Turno Restante: XX:XX</h2>
                    <h2>Puntos Restantes: XXXXX</h2>
                </div>
                <h2>Inventario de PowerUPs</h2>
                    <ul id="inventario-powerups">
                        <li>Sonar 
                            <ul class="descripcion-powerup">
                            <li>Disponible mientras el submarino no haya sido hundido.</li>
                            <li>Revela una casilla al azar de un barco enemigo.</li>
                            <li>Costo: 5 puntos por uso.</li>
                            </ul>
                        </li>
                        <li>Aviones de Ataque
                            <ul class="descripcion-powerup">
                                <li>Disponible mientras el portaaviones no haya sido hundido.</li>
                                <li>Lanza hasta 5 misiles al azar en el tablero enemigo.</li>
                                <li>Costo: 10 puntos por uso.</li>
                            </ul>
                        </li>
                        <li>Mina Marina
                            <ul class="descripcion-powerup">
                                <li>Los jugadores pueden plantar una mina en su propio tablero.</li>
                                <li>Si el enemigo ataca una mina, recibe un "hit" adicional en una casilla adyacente al azar.</li>
                                <li>Costo: 5 puntos para plantar</li>
                            </ul>
                        </li>
                        <li>Escudo Defensivo
                            <ul class="descripcion-powerup">
                                <li>Protege una región de 3x3 casillas durante 3 turnos.</li>
                                <li>Los ataques en el área protegida son anulados y el enemigo recibe un mensaje de "Bloqueado".</li>
                                <li>Costo: 15 puntos.</li>
                            </ul>
                        </li>
                        <li>Misil Crucero
                            <ul class="descripcion-powerup">
                                <li>Ataque dirigido a un área de 3x3 casillas.</li>
                                <li>Costo: 15 puntos.</li>
                                <li>Tiempo de recarga: 5 turnos.</li>
                            </ul>
                        </li>
                        <li>Reparación Rápida
                            <ul  class="descripcion-powerup">
                                <li>Restaura hasta 2 casillas de un barco dañado (no hundido).</li>
                                <li>Costo: 10 puntos.</li>
                                <li>Un solo uso por barco.</li>
                            </ul>
                        </li>
                        <li>Ataque EMP
                            <ul  class="descripcion-powerup">
                                <li>Desactiva todas las funciones especiales del enemigo durante 3 turnos.</li>
                                <li>Costo: 25 puntos.</li>
                                <li>Tiempo de recarga: 10 turnos.</li>
                            </ul>
                        </li>
                    </ul>
                    <div id="control-tablero">
                        <h2>Cambiar a tablero J1</h2>
                        <h2>Cambiar a tablero J2</h2>
                        <h2>Cambiar a tablero J3</h2>
                        <h2>Cambiar a tablero J4</h2>
                    </div>
            </aside>
            <br>
            
            
            

        </main>

        <script>

            const WEBSOCKET_SCHEME = 'ws';
            const WEBSOCKET_SERVER = 'localhost';
            const WEBSOCKET_PORT = 8000;
            const WEBSOCKET_URL = `${WEBSOCKET_SCHEME}://${WEBSOCKET_SERVER}:${WEBSOCKET_PORT}`;
            const socket = new WebSocket(WEBSOCKET_URL);
            console.log(WEBSOCKET_URL);

            nombreJugador = "PlaceHolder";
            juedoId = 1;
            crear = 1;
            let juego;
            
            class mensaje{
                type;
                id;
                jugador;
                constructor(type, id, jugador){
                    this.type = type;
                    this.id = id;
                    this.jugador = jugador;
                }
            }

            function definirDatos() {
                let urlParams = new URLSearchParams(window.location.search);
                nombreJugador = urlParams.get('jugador');
                id = urlParams.get('id');
                crear = urlParams.get('create');
                console.log(nombreJugador);
                console.log(id);
            }

            

            function enviarMensaje(tipo, id, jugador){
                socket.send(JSON.stringify(new mensaje(tipo, id, jugador)));
            }

            function imprimirTablero(nombre){
                for (const jugador of juego.jugadores){
                    if (jugador.nombre == nombre){
                        dibujarTablero(jugador.tablero);
                    }
                }
            }

            socket.addEventListener('message', (event) =>{
                mensaje = JSON.parse(event.data);
                console.log(mensaje);
                if(mensaje.type == "error") {
                    alert(mensaje.descripcion);
                } else {
                    juego = mensaje.tablero;
                    console.log(juego);
                    imprimirTablero(nombreJugador);
                }
            });

            socket.addEventListener('open', (event) =>{
                if (crear == "1"){
                    enviarMensaje("create", id, nombreJugador);
                } else {
                    enviarMensaje("join", id, nombreJugador);
                }
            });

            function dibujarTablero(tablero){
                let hijo;
                console.log(tablero);
                for (const linea of tablero){
                    console.log("linea procesando:");
                    console.log(linea);
                    for (const casilla of linea){
                        console.log(casilla);
                        hijo = document.createElement("div");
                        hijo.setAttribute("posX", "fasdf");
                        hijo.setAttribute("posY", "dfadf");
                        hijo.classList.add("position");
                        hijo.classList.add(casilla.tipo);
                        document.getElementById('tablero').appendChild(hijo);
                    }
                }
            }

            definirDatos();
            
        </script>

</body>
    
</html>